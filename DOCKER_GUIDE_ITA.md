# BrokerFlow AI - Docker Guide (ITA)\n\n## üê≥ Panoramica\n\nQuesta guida fornisce istruzioni complete per l'utilizzo di Docker con BrokerFlow AI, coprendo tutto dal setup base al deployment in produzione.\n\n## üìã Prerequisiti\n\n### Requisiti di Sistema\n- Docker Engine 20.10+\n- Docker Compose 1.29+\n- 4GB+ RAM consigliati\n- 10GB+ spazio disco libero\n\n### Installazione\n```bash\n# Ubuntu/Debian\nsudo apt update\nsudo apt install docker.io docker-compose\n\n# macOS\nbrew install docker docker-compose\n\n# Windows\n# Installa Docker Desktop da https://www.docker.com/products/docker-desktop\n```\n\n### Verifica\n```bash\ndocker --version\ndocker-compose --version\ndocker info\n```\n\n## üöÄ Avvio Veloce\n\n### 1. Clona e Configura\n```bash\ngit clone https://github.com/yourorganization/brokerflow-ai.git\ncd brokerflow-ai\n```\n\n### 2. Configura l'Ambiente\n```bash\ncp .env.example .env\n# Modifica .env con la tua configurazione\n```\n\n### 3. Build e Avvia\n```bash\ndocker-compose up -d\n```\n\n### 4. Accedi ai Servizi\n- Applicazione: http://localhost:8000\n- phpMyAdmin: http://localhost:8080\n- MySQL: localhost:3306\n\n## üìÅ Analisi Dockerfile\n\n### Immagine Base\n```dockerfile\nFROM python:3.10-slim\n```\n- Usa l'immagine ufficiale Python 3.10 slim per ridurre le dimensioni\n- Basata su Debian per compatibilit√†\n\n### Directory di Lavoro\n```dockerfile\nWORKDIR /app\n```\n- Imposta `/app` come directory di lavoro\n- Tutti i comandi successivi vengono eseguiti da questa directory\n\n### Variabili d'Ambiente\n```dockerfile\nENV PYTHONDONTWRITEBYTECODE=1\nENV PYTHONUNBUFFERED=1\n```\n- Impedisce a Python di scrivere file bytecode\n- Assicura che l'output di Python non sia bufferizzato\n\n### Dipendenze di Sistema\n```dockerfile\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n        gcc \\\n        default-libmysqlclient-dev \\\n        pkg-config \\\n        tesseract-ocr \\\n        libtesseract-dev \\\n        poppler-utils \\\n    && rm -rf /var/lib/apt/lists/*\n```\n- Installa strumenti di build essenziali\n- Header di sviluppo client MySQL\n- Motore OCR Tesseract e librerie\n- Utilit√† Poppler per elaborazione PDF\n- Pulisce la cache dei pacchetti per ridurre le dimensioni dell'immagine\n\n### Dipendenze Python\n```dockerfile\nCOPY requirements.txt requirements-dev.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\nRUN pip install --no-cache-dir -r requirements-dev.txt\n```\n- Copia requirements di runtime e sviluppo\n- Installa dipendenze senza caching per ridurre le dimensioni dell'immagine\n\n### Codice Applicazione\n```dockerfile\nCOPY . .\n```\n- Copia l'intero codebase dell'applicazione\n- Esclude file specificati in `.gitignore`\n\n### Setup Directory\n```dockerfile\nRUN mkdir -p inbox output templates\n```\n- Crea le directory necessarie per l'elaborazione dei file\n\n### Esposizione Porte\n```dockerfile\nEXPOSE 8000\n```\n- Espone la porta 8000 per l'accesso API\n- Non pubblica la porta (usa docker-compose per quello)\n\n### Sicurezza\n```dockerfile\nRUN adduser --disabled-password --gecos '' appuser\nRUN chown -R appuser:appuser /app\nUSER appuser\n```\n- Crea utente non-root per sicurezza\n- Cambia la propriet√† dei file dell'applicazione\n- Esegue il container come utente non-root\n\n### Comando di Avvio\n```dockerfile\nCMD [\"python\", \"main.py\"]\n```\n- Comando predefinito per eseguire l'applicazione\n\n## üê≥ Configurazione Docker Compose\n\n### Panoramica Servizi\n```yaml\nversion: '3.8'\n\nservices:\n  brokerflow:    # Applicazione principale\n  db:           # Database MySQL\n  phpmyadmin:   # Interfaccia gestione database\n  redis:        # Servizio cache\n```\n\n### 1. Servizio Applicazione Principale\n```yaml\nbrokerflow:\n  build: .\n  ports:\n    - \"8000:8000\"\n  environment:\n    - MYSQL_HOST=db\n    - MYSQL_USER=brokerflow\n    - MYSQL_PASSWORD=brokerflow123\n    - MYSQL_DATABASE=brokerflow_ai\n    - OPENAI_API_KEY=${OPENAI_API_KEY}\n  volumes:\n    - ./inbox:/app/inbox\n    - ./output:/app/output\n    - ./templates:/app/templates\n    - ./logs:/app/logs\n  depends_on:\n    - db\n  restart: unless-stopped\n```\n\n**Configurazione Principale:**\n- **Build**: Costruisce dall'attuale Dockerfile\n- **Ports**: Mappa la porta host 8000 alla porta container 8000\n- **Environment**: Imposta variabili d'ambiente per database e API key\n- **Volumes**: Monta directory host per dati persistenti\n- **Depends On**: Assicura che il database si avvii prima dell'applicazione\n- **Restart**: Riavvia automaticamente a meno che non venga fermato manualmente\n\n### 2. Servizio Database\n```yaml\ndb:\n  image: mysql:8.0\n  environment:\n    - MYSQL_ROOT_PASSWORD=root123\n    - MYSQL_USER=brokerflow\n    - MYSQL_PASSWORD=brokerflow123\n    - MYSQL_DATABASE=brokerflow_ai\n  volumes:\n    - db_data:/var/lib/mysql\n    - ./schema.sql:/docker-entrypoint-initdb.d/schema.sql\n  ports:\n    - \"3306:3306\"\n  restart: unless-stopped\n```\n\n**Configurazione Principale:**\n- **Image**: Immagine MySQL 8.0 ufficiale\n- **Environment**: Credenziali database e setup iniziale\n- **Volumes**: \n  - `db_data`: Volume nominato per storage persistente\n  - `schema.sql`: Inizializza lo schema database\n- **Ports**: Espone la porta MySQL per accesso esterno\n\n### 3. Servizio phpMyAdmin\n```yaml\nphpmyadmin:\n  image: phpmyadmin/phpmyadmin\n  environment:\n    - PMA_HOST=db\n    - PMA_USER=root\n    - PMA_PASSWORD=root123\n  ports:\n    - \"8080:80\"\n  depends_on:\n    - db\n  restart: unless-stopped\n```\n\n**Configurazione Principale:**\n- **Image**: Immagine phpMyAdmin ufficiale\n- **Environment**: Connette al database MySQL\n- **Ports**: Mappa la porta host 8080 alla porta container 80\n- **Depends On**: Assicura che il database si avvii prima\n\n### 4. Servizio Redis\n```yaml\nredis:\n  image: redis:7-alpine\n  ports:\n    - \"6379:6379\"\n  restart: unless-stopped\n```\n\n**Configurazione Principale:**\n- **Image**: Immagine Redis Alpine leggera\n- **Ports**: Espone la porta Redis per caching\n- **Restart**: Policy di riavvio automatico\n\n### Volumi\n```yaml\nvolumes:\n  db_data:\n```\n- **db_data**: Volume nominato per storage database persistente\n\n## ‚öôÔ∏è Configurazione Ambiente\n\n### Struttura File .env\n```bash\n# Configurazione OpenAI API\nOPENAI_API_KEY=your_openai_api_key_here\n\n# Configurazione Database MySQL\nMYSQL_HOST=localhost\nMYSQL_USER=your_mysql_username\nMYSQL_PASSWORD=your_mysql_password\nMYSQL_DATABASE=brokerflow_ai\n\n# Configurazione Email\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USER=your_email@gmail.com\nSMTP_PASSWORD=your_email_password\n\n# Configurazione Sistema\nINBOX_PATH=inbox/\nOUTPUT_PATH=output/\nTEMPLATE_PATH=templates/\n\n# Configurazione Logging\nLOG_LEVEL=INFO\nLOG_FILE=brokerflow.log\n\n# Configurazione Sicurezza\nSECRET_KEY=your_secret_key_here\nJWT_EXPIRATION_DAYS=30\n```\n\n### Variabili d'Ambiente Docker\nLe variabili possono essere impostate in diversi modi:\n\n1. **File .env** (consigliato per sviluppo)\n2. **Linea di comando** (per override)\n3. **Docker Compose** (per impostazioni specifiche servizio)\n\n### Dati Sensibili\n```bash\n# Non committare mai le API key nel version control\n# Usa il file .env e aggiungilo a .gitignore\necho \".env\" >> .gitignore\n```\n\n## ‚ñ∂Ô∏è Esecuzione Servizi Docker\n\n### Comandi Base\n\n#### Avvia Tutti i Servizi\n```bash\ndocker-compose up -d\n```\n- `-d`: Esegue in modalit√† detached (background)\n\n#### Visualizza Log\n```bash\n# Tutti i servizi\ndocker-compose logs -f\n\n# Servizio specifico\ndocker-compose logs -f brokerflow\n\n# Ultime 100 righe\ndocker-compose logs --tail=100 brokerflow\n```\n\n#### Ferma Servizi\n```bash\n# Ferma tutti i servizi\ndocker-compose down\n\n# Ferma servizio specifico\ndocker-compose stop brokerflow\n\n# Ferma e rimuove volumi\ndocker-compose down -v\n```\n\n#### Riavvia Servizi\n```bash\n# Riavvia tutti i servizi\ndocker-compose restart\n\n# Riavvia servizio specifico\ndocker-compose restart db\n```\n\n### Gestione Servizi\n\n#### Visualizza Servizi in Esecuzione\n```bash\ndocker-compose ps\n```\n\n#### Esegui Comandi nel Container\n```bash\n# Accedi alla shell del container\ndocker-compose exec brokerflow bash\n\n# Esegui comando specifico\ndocker-compose exec brokerflow python main.py\n\n# Accedi al database\ndocker-compose exec db mysql -u brokerflow -p brokerflow_ai\n```\n\n#### Build Immagini\n```bash\n# Ricostruisci tutti i servizi\ndocker-compose build\n\n# Ricostruisci servizio specifico\ndocker-compose build brokerflow\n\n# Forza ricostruzione senza cache\ndocker-compose build --no-cache brokerflow\n```\n\n## üìÅ Gestione Volumi\n\n### Tipi di Volumi\n\n#### Volumi Nominati\n```yaml\nvolumes:\n  db_data:\n```\n- Gestiti da Docker\n- Persistenti tra riavvii container\n- Posizionati nell'area di storage di Docker\n\n#### Bind Mounts\n```yaml\nvolumes:\n  - ./inbox:/app/inbox\n  - ./output:/app/output\n```\n- Mappa directory host a container\n- Accesso diretto ai file dall'host\n- Utili per sviluppo\n\n### Comandi Volumi\n\n#### Elenca Volumi\n```bash\ndocker volume ls\n```\n\n#### Ispeziona Volume\n```bash\ndocker volume inspect brokerflow_ai_db_data\n```\n\n#### Rimuovi Volumi\n```bash\n# Rimuovi volume specifico\ndocker volume rm brokerflow_ai_db_data\n\n# Rimuovi volumi inutilizzati\ndocker volume prune\n```\n\n### Persistenza Dati\n\n#### Backup Volume Database\n```bash\n# Crea backup\ndocker run --rm \\\n  -v brokerflow_ai_db_data:/source \\\n  -v $(pwd):/backup \\\n  alpine tar czf /backup/db_backup.tar.gz -C /source .\n```\n\n#### Ripristina Volume Database\n```bash\n# Ripristina da backup\ndocker run --rm \\\n  -v brokerflow_ai_db_data:/target \\\n  -v $(pwd):/backup \\\n  alpine tar xzf /backup/db_backup.tar.gz -C /target\n```\n\n## üîß Configurazione e Personalizzazione\n\n### Dockerfile Personalizzato\nCrea `Dockerfile.custom` per esigenze specifiche:\n\n```dockerfile\nFROM brokerflow/brokerflow-ai:latest\n\n# Installa dipendenze aggiuntive\nRUN apt-get update && apt-get install -y \\\n    additional-package \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Copia configurazione personalizzata\nCOPY custom-config.yaml /app/config/custom.yaml\n\n# Espone porte aggiuntive\nEXPOSE 8000 9000\n\n# Comando di avvio personalizzato\nCMD [\"python\", \"main.py\", \"--config\", \"custom.yaml\"]\n```\n\n### File Compose Specifici per Ambiente\nCrea `docker-compose.prod.yml` per produzione:\n\n```yaml\nversion: '3.8'\n\nservices:\n  brokerflow:\n    build: .\n    environment:\n      - DEBUG=false\n      - LOG_LEVEL=WARNING\n    deploy:\n      replicas: 3\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    restart: always\n\n  db:\n    environment:\n      - MYSQL_ROOT_PASSWORD_FILE=/run/secrets/db_root_password\n    secrets:\n      - db_root_password\n\nsecrets:\n  db_root_password:\n    file: ./secrets/db_root_password.txt\n```\n\n### Override Configurazione\n```bash\n# Usa file compose multipli\ndocker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d\n```\n\n## üõ† Risoluzione Problemi\n\n### Problemi Comuni\n\n#### 1. Porta Gi√† in Uso\n```bash\n# Controlla quale processo usa la porta\nlsof -i :8000\n\n# Termina il processo\nkill -9 <PID>\n\n# O cambia porta in docker-compose.yml\n```\n\n#### 2. Problemi Connessione Database\n```bash\n# Controlla se il database √® in esecuzione\ndocker-compose ps db\n\n# Controlla log database\ndocker-compose logs db\n\n# Testa connessione database\ndocker-compose exec brokerflow \\\n  mysql -h db -u brokerflow -p brokerflow_ai -e \"SELECT 1;\"\n```\n\n#### 3. Problemi Permessi\n```bash\n# Correggi permessi file\nsudo chown -R $(id -u):$(id -g) inbox output templates logs\n\n# O esegui come root (non consigliato per produzione)\n# Rimuovi USER appuser dal Dockerfile\n```\n\n#### 4. Problemi Mount Volumi\n```bash\n# Controlla mount volumi\ndocker-compose exec brokerflow ls -la /app\n\n# Verifica esistenza directory host\nls -la inbox output templates\n```\n\n### Comandi Debug\n\n#### Informazioni Container\n```bash\n# Ispeziona container\ndocker inspect brokerflow_ai_brokerflow_1\n\n# Controlla risorse container\ndocker stats brokerflow_ai_brokerflow_1\n\n# Visualizza processi container\ndocker top brokerflow_ai_brokerflow_1\n```\n\n#### Debug Rete\n```bash\n# Controlla configurazione rete\ndocker network ls\ndocker network inspect brokerflow_ai_default\n\n# Testa connettivit√† tra container\ndocker-compose exec brokerflow ping db\n```\n\n#### Debug Immagini\n```bash\n# Visualizza layer immagine\ndocker history brokerflow/brokerflow-ai\n\n# Ispeziona immagine\ndocker inspect brokerflow/brokerflow-ai:latest\n```\n\n## üìä Monitoraggio e Logging\n\n### Logging Docker\n\n#### Configura Driver Logging\n```yaml\nservices:\n  brokerflow:\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n```\n\n#### Visualizza Log\n```bash\n# Log in tempo reale\ndocker-compose logs -f\n\n# Filtra log per data\ndocker-compose logs --since=\"2025-08-13\"\n\n# Filtra log per pattern\ndocker-compose logs | grep ERROR\n```\n\n### Monitoraggio Risorse\n\n#### Risorse Container\n```bash\n# Monitora tutti i container\ndocker stats\n\n# Monitora container specifico\ndocker stats brokerflow_ai_brokerflow_1\n```\n\n#### Risorse Sistema\n```bash\n# Controlla statistiche Docker daemon\ndocker system df\n\n# Visualizza informazioni sistema\ndocker info\n```\n\n## üöÄ Deployment Produzione\n\n### Best Practices\n\n#### Sicurezza\n```yaml\n# docker-compose.yml produzione\nservices:\n  brokerflow:\n    environment:\n      - DEBUG=false\n      - SECRET_KEY_FILE=/run/secrets/secret_key\n    secrets:\n      - secret_key\n    restart: always\n    security_opt:\n      - no-new-privileges:true\n    read_only: true\n    tmpfs:\n      - /tmp\n```\n\n#### Limiti Risorse\n```yaml\nservices:\n  brokerflow:\n    deploy:\n      resources:\n        limits:\n          memory: 1G\n          cpus: '0.5'\n        reservations:\n          memory: 512M\n          cpus: '0.25'\n```\n\n#### Health Checks\n```yaml\nservices:\n  brokerflow:\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n```\n\n### Scaling\n\n#### Scaling Orizzontale\n```bash\n# Scala servizio specifico\ndocker-compose up -d --scale brokerflow=3\n```\n\n#### Load Balancing\nUsa load balancer esterno come NGINX o HAProxy per produzione.\n\n### Strategia Backup\n\n#### Backup Automatici\n```bash\n# Crea script backup\n#!/bin/bash\ndocker-compose exec db mysqldump -u root -p$MYSQL_ROOT_PASSWORD brokerflow_ai > backup_$(date +%Y%m%d_%H%M%S).sql\n```\n\n#### Backup Pianificati\n```bash\n# Aggiungi a crontab\n0 2 * * * /path/to/backup_script.sh\n```\n\n## üîí Considerazioni Sicurezza\n\n### Sicurezza Immagini\n```bash\n# Scansiona immagini per vulnerabilit√†\ndocker scan brokerflow/brokerflow-ai\n\n# Usa immagini base ufficiali\n# Mantieni immagini aggiornate\n# Rimuovi pacchetti non necessari\n```\n\n### Sicurezza Runtime\n```yaml\nservices:\n  brokerflow:\n    user: \"1000:1000\"  # Utente non-root\n    read_only: true    # Filesystem read-only\n    tmpfs:\n      - /tmp          # Filesystem temporaneo scrivibile\n    security_opt:\n      - no-new-privileges:true\n```\n\n### Gestione Secret\n```yaml\n# Usa Docker secrets\nservices:\n  brokerflow:\n    secrets:\n      - db_password\n      - openai_api_key\n\nsecrets:\n  db_password:\n    file: ./secrets/db_password.txt\n  openai_api_key:\n    file: ./secrets/openai_api_key.txt\n```\n\n## üéØ Utilizzo Avanzato\n\n### Build Multi-stage\n```dockerfile\n# Stage build\nFROM python:3.10-slim as builder\n# Installa dipendenze build e compila\n\n# Stage runtime\nFROM python:3.10-slim as runtime\n# Copia solo file necessari dal builder\n# Installa solo dipendenze runtime\n```\n\n### Reti Personalizzate\n```yaml\nnetworks:\n  frontend:\n    driver: bridge\n  backend:\n    driver: bridge\n\nservices:\n  brokerflow:\n    networks:\n      - frontend\n      - backend\n```\n\n### Volumi Nominati per Path Specifici\n```yaml\nvolumes:\n  db_data:\n  logs_data:\n\nservices:\n  brokerflow:\n    volumes:\n      - logs_data:/app/logs\n  db:\n    volumes:\n      - db_data:/var/lib/mysql\n```\n\n## üìû Supporto\n\n### Documentazione\n- Guide utente nella directory `docs/`\n- Documentazione API\n- Guide risoluzione problemi\n\n### Supporto Community\n- GitHub Issues: https://github.com/yourorganization/brokerflow-ai/issues\n- GitHub Discussions: https://github.com/yourorganization/brokerflow-ai/discussions\n\n### Supporto Professionale\n- Email: support@brokerflow.ai\n- SLA: Supporto 24/7 per clienti enterprise\n\n---\n\n*Ultimo aggiornamento: 13 agosto 2025*\n*Versione: 1.0*